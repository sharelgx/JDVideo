# 京东直播商品视频下载 Chrome 插件 PRD

## 背景与目标
- 在京东直播讲解页（例：`https://jlive.jd.com/explain?id=34692963`）一键下载列表中的商品视频。
- 用户已登录京东，插件负责解析视频真实地址并按命名规则保存：`SKUID_[标题名].mp4`。

## 目标用户与场景
- 用户：直播运营、店铺管理员、素材整理人员。
- 场景：打开直播讲解页后，通过插件弹窗或页内浮层解析列表，批量或单个下载视频。

## 范围与功能需求
- 适配页面：`https://jlive.jd.com/explain?id=*`。
- 解析内容：
  - 定位包含商品信息的节点（类名示例：`antd-pro-pages-explain-components-table-list-goodsInfoContent`）。
  - 提取 SKU（如 `10123926755929`）、商品标题、对应视频的真实下载地址（可能藏于复杂事件或请求）。
- 下载能力：
  - 支持批量/单个下载；并发可配置（默认 3），失败重试 2 次。
  - 文件命名：`SKUID_[标题名].mp4`，清洗非法文件字符。
- 交互：
  - 浏览器工具栏按钮 → 弹出控制面板（解析列表、批量下载、仅选中下载）。
  - 页内右下浮层按钮「批量下载」；结果列表显示标题/SKU/状态（待下载、下载中、成功、失败）、重试按钮。
  - 解析或下载失败提示（未找到视频地址、无权限、网络错误）。
- 状态反馈：
  - 解析进度、下载进度条/百分比。
  - 全部完成提示；失败可单项或批量重试。
- 配置项：
  - 并发上限、重试次数、文件命名模板（默认模板保留）。
- 权限：
  - `activeTab`、`scripting`、`downloads`，以及 `host_permissions: ["https://jlive.jd.com/*"]`。

## 非功能与约束
- 前提：浏览器已登录京东（复用页面 Cookie）。
- 性能：列表 ≤20 条解析 <2s；下载并发默认 3，避免风控。
- 兼容：Chrome Manifest V3。
- 稳定性：失败可重试，必要时保留回退方案（手动触发一次“下载”来抓取真实 URL）。

## 成功度量
- 解析成功率 ≥95%（在 DOM 结构匹配时）。
- 下载成功率 ≥90%（网络与账号正常前提）。
- 单次批量（≤20 条）全流程 <1 分钟（视网速而定）。

## 风险与应对
- DOM 变动：使用稳健选择器（父级关系 + “下载”文本匹配），代码注释提示更新点。
- 视频地址复杂/鉴权：拦截与“下载”按钮关联的 fetch/XHR 请求或读取按钮绑定数据；复用 Cookie/Referer；找不到时提示用户手动点击以捕获本次请求 URL。
- 反爬/频控：控制并发与重试，异常提示稍后再试。

## 交互草案
- 工具栏弹窗：展示“解析列表”“批量下载”“仅选中下载”；下方列表含标题/SKU/状态/操作。
- 页内浮层：右下角悬浮「批量下载」，点击后展示结果与进度。

## 技术实现要点（供研发参考）
- Manifest V3；权限如上。
- Content Script：
  - 解析 `div.antd-pro-pages-explain-components-table-list-goodsInfoContent`，向上/兄弟节点提取 SKU（匹配 `SKUID：(\d+)`）和标题。
  - 寻找“下载”节点（如 `<p>下载</p>`），从其事件或父级数据属性获取视频地址；必要时注入脚本拦截 fetch/XHR 以捕获真实 URL（含 302/签名参数）。
  - 清洗文件名并通过 `postMessage` 将解析结果发送给 Service Worker。
- Service Worker（后台）：
  - 维护下载队列；按并发调度 `chrome.downloads.download`，设置文件名 `SKUID_[标题名].mp4`。
  - 追踪状态并回传给弹窗/浮层。
- UI：
  - Popup 或页内注入面板（可用原生或轻量框架）。
  - 显示状态、进度、失败重试入口。

## 交付物
- 插件代码：`manifest.json`、Service Worker、content script、注入脚本、弹窗/浮层 UI。
- `README`：开发者模式加载步骤、使用指南、命名规则说明、常见问题与权限说明。




