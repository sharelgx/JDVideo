# 京东直播视频下载 Chrome 插件

基于 Manifest V3 的插件，解析京东直播讲解页并按 `SKUID_[标题名].mp4` 下载商品视频。

## 安装（开发者模式）
1. 打开 Chrome 扩展管理页：地址栏输入 `chrome://extensions/`。
2. 右上角打开「开发者模式」。
3. 点击「加载已解压的扩展程序」，选择本项目下的 `extension` 目录。
4. 安装完成后，固定工具栏图标以便使用。

## 使用步骤
1. 在浏览器登录京东账号（已在 Cursor 内置浏览器登录即可复用 Cookie）。
2. 打开直播讲解页，例如 `https://jlive.jd.com/explain?id=34692963`。
3. 点击插件图标，弹窗中点击「解析列表」获取商品列表。
4. 若未捕获到 URL，可点击弹窗的「自动捕获 URL」：插件会按顺序自动点击列表中的“下载”按钮，拦截真实视频地址；完成后重新展示捕获结果。
5. 若自动捕获仍未成功，手动在页面点击对应“下载”按钮，然后回到弹窗点「解析列表」。
6. 点击「批量下载」开始下载；文件命名规则：`SKUID_[标题名].mp4`，非法字符会被替换为 `_`。
7. （可选）在弹窗填写「本地下载服务地址」「本地服务目标目录（绝对路径）」，点击「发送到本地服务下载」，由本地 Python 服务直接写入指定目录（推荐方式，可绕过浏览器下载目录限制）。

## 目录结构
```
extension/
  manifest.json   # MV3 配置
  background.js   # 下载队列与并发控制
  content.js      # DOM 解析、点击钩子、与注入脚本通信
  inject.js       # 页面上下文拦截 fetch/XHR 捕获视频 URL
  popup.html/js/css # 弹窗 UI
PRD.md            # 产品需求文档
```

## 已实现要点
- DOM 解析：根据类名 `antd-pro-pages-explain-components-table-list-goodsInfoContent` 提取标题与 `SKUID`。
- URL 捕获：注入脚本拦截页面内 fetch/XMLHttpRequest，请求命中视频特征时记录 URL，并与最近点击的 SKU 关联。
- 自动捕获：弹窗可触发内容脚本依次点击“下载”按钮（含节流与重试），无需手动逐条点击。
- 下载队列：后台脚本并发（默认 3）、失败重试（默认 2），命名 `SKUID_[标题名].mp4`。
- 弹窗：展示解析结果、状态提示与批量下载入口；可将 URL 发送到本地 Python 服务直接保存到指定绝对路径（无浏览器目录限制）。

## 本地 Python 下载服务（可选）
若需将文件直接保存到任意目录，可使用 `local_downloader.py`：

1. 安装依赖：`pip install requests`
2. 启动服务示例：`python local_downloader.py --host 127.0.0.1 --port 3030 --root D:/JDDownloads --concurrency 3`
3. 在插件弹窗填写：
   - 本地下载服务地址：`http://127.0.0.1:3030`
   - 本地服务目标目录（绝对路径，可留空使用启动参数 root）：如 `D:/JDDownloads`
4. 点击「发送到本地服务下载」，服务将并发下载到指定目录，并在控制台输出日志。

## 注意与限制
- 需在登录状态下使用；插件不处理登录流程。
- 若页面结构或下载按钮逻辑变动，可能需要调整选择器或拦截逻辑。
- 若未捕获到 URL，请在页面手动点击一次「下载」后再解析；复杂鉴权场景可能需要补充自定义头信息。


